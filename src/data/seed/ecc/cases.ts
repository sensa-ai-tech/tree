import type { CaseChallenge } from '@/types/case';

export const ECC_CASES: CaseChallenge[] = [
  {
    id: 'CASE-ECC-001',
    title: '公貓急性尿道阻塞的急診處置',
    specialty: 'ECC',
    cross_specialties: ['IM'],
    required_nodes: ['ECC-L3-004', 'ECC-L1-002', 'ECC-L4-001', 'ECC-L5-001'],
    difficulty: 4,
    species: '貓',
    scenario: {
      signalment: '4 歲已絕育公貓，體重 5.8 kg，室內飼養',
      chief_complaint: '今日發現蹲在貓砂盆超過 30 分鐘無法排尿，持續嚎叫',
      brief_history: '過去 3 天飼主注意到頻繁進出貓砂盆但尿量極少。今晨開始嘔吐 2 次，精神極度沉鬱，不進食。過去病史：1 年前曾有一次下泌尿道症狀（FLUTD）發作，當時保守治療後改善。飲食為乾飼料為主，飲水量偏少。',
    },
    steps: [
      {
        step_number: 1,
        step_type: 'history_collection',
        title: '病史採集',
        prompt: '在初級評估之前，你需要快速確認哪些關鍵病史？請選擇最重要的 3 項。',
        available_actions: [
          '確認最後一次成功排尿的時間',
          '確認嘔吐物的內容與頻率',
          '確認是否有使用任何藥物或保健品',
          '確認過去泌尿道問題的治療細節',
          '確認飲食種類（乾糧 vs 濕糧）與飲水量',
          '確認家中是否有其他貓及社交壓力',
        ],
        correct_actions: [
          '確認最後一次成功排尿的時間',
          '確認嘔吐物的內容與頻率',
          '確認是否有使用任何藥物或保健品',
        ],
        feedback_correct: '很好！最後排尿時間有助於判斷阻塞時長與代謝紊亂程度。嘔吐是尿毒症的徵兆，反映病情嚴重度。藥物史對治療決策很重要（如 NSAIDs 可能影響腎功能）。',
        feedback_incorrect: '在急診情境下需優先確認與當下危急程度直接相關的資訊。阻塞時間越長，高血鉀與代謝性酸中毒風險越高。飲食與社交壓力是重要的長期管理因素，但在急性處置階段非最優先。',
        key_learning_points: [
          '貓尿道阻塞 > 24 小時即可能出現危及生命的高血鉀',
          '嘔吐、沉鬱為尿毒症的全身性徵兆',
          '阻塞時長是預測代謝紊亂嚴重度的最重要因子',
        ],
      },
      {
        step_number: 2,
        step_type: 'physical_examination',
        title: '理學檢查（ABCDE 初級評估）',
        prompt: '病史補充：最後成功排尿約 36 小時前，嘔吐物為白色泡沫，未使用任何藥物。你進行 ABCDE 初級評估，請選擇最關鍵的異常發現。',
        available_actions: [
          'A/B：呼吸速率 48 次/分，輕度腹式呼吸',
          'C：心率 160 bpm（偏低），節律不整，黏膜蒼白偏灰，CRT 3 秒',
          'C：股動脈脈搏微弱',
          'D：精神極度沉鬱（Voice-responsive），對疼痛刺激有反應',
          'E：體溫 36.2 C（低體溫），腹部極度緊繃疼痛',
          '觸診膀胱極度脹大且堅硬',
        ],
        correct_actions: [
          'C：心率 160 bpm（偏低），節律不整，黏膜蒼白偏灰，CRT 3 秒',
          'E：體溫 36.2 C（低體溫），腹部極度緊繃疼痛',
          '觸診膀胱極度脹大且堅硬',
        ],
        feedback_correct: '正確！心搏過緩（貓正常 > 180 bpm）合併心律不整在尿道阻塞的貓高度提示致命性高血鉀。低體溫（36.2 C）反映末梢灌流不足與代謝功能下降。膀胱極度脹大確認完全阻塞。這是紅色（即刻）分診——需立即處理高血鉀。',
        feedback_incorrect: '在尿道阻塞的貓，最關鍵的發現是心搏過緩與心律不整（提示高血鉀）、低體溫（提示嚴重代謝障礙）以及膀胱脹大（確認阻塞）。心律不整是最具致命性的問題，必須立即處理。',
        key_learning_points: [
          '貓心率 < 180 bpm 為心搏過緩，在尿道阻塞背景下高度提示高血鉀',
          '高血鉀導致的心律不整（心搏過緩→房室傳導阻滯→心室停搏）是最常見致死原因',
          '低體溫在急重症貓是嚴重度與不良預後的指標',
        ],
      },
      {
        step_number: 3,
        step_type: 'diagnostic_plan',
        title: '緊急診斷檢查',
        prompt: '你判斷此為紅色分診病患，需立即處置。在開始治療前，你需要哪些最基本的緊急診斷？選擇 3 項。',
        available_actions: [
          'ECG 監測（確認心律不整型態）',
          '靜脈血氣與電解質（重點看 K+）',
          'PCV/TP 與血糖快速測試',
          '完整 CBC 與生化',
          '尿液分析與培養',
          '腹部 X 光',
        ],
        correct_actions: [
          'ECG 監測（確認心律不整型態）',
          '靜脈血氣與電解質（重點看 K+）',
          'PCV/TP 與血糖快速測試',
        ],
        feedback_correct: '完美！ECG 即時監測心律不整型態以指導 calcium gluconate 的使用。血氣電解質確認 K+ 數值與酸鹼狀態。PCV/TP/血糖為最基本的急診 baseline。完整生化和尿檢可以穩定後再做。',
        feedback_incorrect: '急診情境下需要的是能「立即得到結果並指導治療」的快速檢查。完整 CBC/生化需要時間等結果，不適合作為最緊急的診斷。ECG 和 blood gas 可以在幾分鐘內得到結果並直接影響處置。',
        key_learning_points: [
          'ECG 是評估高血鉀心臟毒性的即時工具',
          '高血鉀 ECG 變化依序：T 波高尖→P 波消失→QRS 增寬→sine wave→心室停搏',
          '急診 baseline 三快篩：PCV/TP、血糖、血氣電解質',
        ],
      },
      {
        step_number: 4,
        step_type: 'result_interpretation',
        title: '檢查結果判讀',
        prompt: '緊急檢查結果如下：\n- ECG：心搏過緩 140 bpm，無 P 波，QRS 波增寬\n- 血氣：pH 7.18，K+ 8.2 mEq/L，Na+ 148 mEq/L，iCa 1.05 mmol/L\n- PCV 38%，TP 7.2 g/dL，血糖 95 mg/dL\n- BUN（stick）> 130 mg/dL\n\n最需要立即處理的問題是什麼？',
        available_actions: [
          '致命性高血鉀（K+ 8.2 mEq/L）合併嚴重 ECG 變化——立即給予 10% calcium gluconate',
          '代謝性酸中毒（pH 7.18）——立即給予 sodium bicarbonate',
          '氮血症（BUN > 130）——立即導尿減壓',
          '低體溫——立即保溫',
        ],
        correct_actions: [
          '致命性高血鉀（K+ 8.2 mEq/L）合併嚴重 ECG 變化——立即給予 10% calcium gluconate',
        ],
        feedback_correct: '正確！K+ 8.2 mEq/L 合併 ECG 顯示無 P 波和 QRS 增寬，為致命性高血鉀。Calcium gluconate（10%，0.5-1.5 mL/kg IV slow over 5-10 min）可在數分鐘內穩定心肌細胞膜電位，是最優先處置。它不降低血鉀，而是保護心肌。降鉀需後續靠輸液與導尿。',
        feedback_incorrect: '雖然酸中毒、氮血症和低體溫都需要處理，但高血鉀導致的心律不整可在數分鐘內致死。Calcium gluconate 是唯一能在數分鐘內保護心肌免於高血鉀毒性的藥物。導尿前必須先穩定心律。',
        key_learning_points: [
          'K+ > 7-8 mEq/L 合併 ECG 變化為醫療緊急狀態',
          '10% Calcium gluconate 0.5-1.5 mL/kg IV slow：穩定心肌膜電位（不降鉀）',
          '給予 calcium gluconate 時需 ECG 監測，過快給予可能導致心搏過緩',
          '降鉀順序：calcium gluconate（保護心肌）→ 輸液稀釋 → insulin + glucose → 導尿排鉀',
        ],
      },
      {
        step_number: 5,
        step_type: 'treatment_plan',
        title: '穩定後治療計畫',
        prompt: 'Calcium gluconate 給予後 ECG 顯示心率回升至 190 bpm，恢復竇性節律。下一步治療計畫為何？選擇最適當的組合。',
        available_actions: [
          '0.9% NaCl 靜脈輸液（避免含鉀液體）+ 鎮靜後導尿 + 持續 ECG 監測',
          'Lactated Ringers Solution 靜脈輸液 + 立即導尿不需鎮靜',
          '繼續觀察，等血鉀完全正常後再導尿',
          'Sodium bicarbonate 靜脈注射 + 導尿 + 0.9% NaCl 輸液',
        ],
        correct_actions: [
          '0.9% NaCl 靜脈輸液（避免含鉀液體）+ 鎮靜後導尿 + 持續 ECG 監測',
        ],
        feedback_correct: '正確！使用 0.9% NaCl 而非 LRS（含 K+ 4 mEq/L）避免進一步增加鉀負荷。導尿需適當鎮靜（如 butorphanol 0.2 mg/kg IV + midazolam 0.2 mg/kg IV），減少動物壓力並放鬆尿道。持續 ECG 監測追蹤心律變化。',
        feedback_incorrect: 'LRS 含鉀 4 mEq/L，在高血鉀病患應避免使用。導尿不鎮靜會造成動物極大痛苦且增加尿道損傷風險。等血鉀完全正常再導尿延誤治療。0.9% NaCl 為高血鉀病患的首選輸液。',
        key_learning_points: [
          '高血鉀病患避免含鉀輸液（LRS、Plasma-Lyte），改用 0.9% NaCl',
          '導尿前必須適當鎮靜，常用方案：butorphanol + midazolam 或 propofol 低劑量',
          '導尿使用 3.5 Fr（紅色）導尿管，以生理食鹽水沖洗通暢阻塞',
          '導尿後需裝置封閉式集尿系統，監測尿量（目標 > 1-2 mL/kg/hr）',
        ],
      },
      {
        step_number: 6,
        step_type: 'treatment_plan',
        title: '住院監測與後續管理',
        prompt: '導尿成功，引流出約 180 mL 深色混濁尿液。導尿管已留置並連接封閉式集尿袋。住院期間最重要的監測項目為何？選擇 3 項。',
        available_actions: [
          '每 4-6 小時監測血鉀與電解質',
          '每小時記錄尿量（目標 > 1-2 mL/kg/hr）',
          '持續 ECG 監測至少 24 小時',
          '每日監測體重',
          '每日 CBC 追蹤',
          '每 2 小時測量血壓',
        ],
        correct_actions: [
          '每 4-6 小時監測血鉀與電解質',
          '每小時記錄尿量（目標 > 1-2 mL/kg/hr）',
          '持續 ECG 監測至少 24 小時',
        ],
        feedback_correct: '正確！血鉀需持續追蹤直到穩定正常化。導尿後可能出現阻塞後利尿（post-obstructive diuresis），尿量可能極大，需相應調整輸液速率避免脫水。ECG 監測追蹤心律，因血鉀變化可再次引發心律不整。',
        feedback_incorrect: '導尿後最關鍵的三項監測：(1) 電解質（血鉀可能快速變化）、(2) 尿量（post-obstructive diuresis 可導致大量利尿）、(3) ECG（心律監測）。血壓和體重有用但非最優先。CBC 通常非急性期重點。',
        key_learning_points: [
          'Post-obstructive diuresis：導尿後可能出現大量利尿，需輸液速率匹配',
          '血鉀可能在導尿後快速下降，也可能因細胞內鉀再分布而先升再降',
          '導尿管通常留置 24-72 小時，拔管前需確認尿液清澈且自行排尿正常',
        ],
      },
      {
        step_number: 7,
        step_type: 'case_summary',
        title: '病例總結與出院衛教',
        prompt: '48 小時後血鉀正常（4.1 mEq/L），BUN 45 mg/dL，拔除導尿管後觀察 12 小時可自行排尿。出院衛教最重要的建議為？選擇最適當的 3 項。',
        available_actions: [
          '轉換為泌尿道處方濕糧，增加飲水量',
          '增設貓砂盆（家中貓數 + 1 原則）並減少環境壓力',
          '教導飼主觀察排尿狀況：頻尿、血尿、排尿困難需立即就醫',
          '建議預防性使用抗生素',
          '建議每週帶回醫院做超音波追蹤',
          '限制活動量 2 週',
        ],
        correct_actions: [
          '轉換為泌尿道處方濕糧，增加飲水量',
          '增設貓砂盆（家中貓數 + 1 原則）並減少環境壓力',
          '教導飼主觀察排尿狀況：頻尿、血尿、排尿困難需立即就醫',
        ],
        feedback_correct: '正確！泌尿道處方濕糧增加水分攝取並優化尿液 pH 與礦物質組成，是預防復發的基石。環境豐富化與壓力管理（多水碗、多砂盆、Feliway）針對 FLUTD 的壓力因子。飼主衛教辨識早期徵兆可避免再次嚴重阻塞。',
        feedback_incorrect: '預防性抗生素無實證支持且可能促進抗藥性。每週超音波追蹤過度且非必要。限制活動量無實證支持。預防復發的核心在於：增加飲水（濕糧）、減壓（環境管理）、飼主衛教（早期辨識）。',
        key_learning_points: [
          '貓尿道阻塞復發率高達 30-40%，預防措施至關重要',
          '增加飲水量（濕糧、噴泉飲水器）是降低復發率最有效的策略',
          '環境壓力是 FLUTD 的重要促發因子',
          '飼主衛教：任何排尿異常都需立即就醫，不要「再觀察看看」',
        ],
      },
    ],
    expert_pathway: {
      reasoning: '4 歲絕育公貓 + 36 小時無法排尿 + 心搏過緩 + 低體溫 = 高度疑似完全尿道阻塞合併致命性高血鉀。處置優先順序：(1) ABCDE 評估 → (2) ECG 確認心律不整 → (3) Calcium gluconate 穩定心肌 → (4) 0.9% NaCl 輸液 → (5) 鎮靜後導尿減壓 → (6) 住院監測 → (7) 出院衛教預防復發。',
      key_decisions: [
        '辨識心搏過緩為高血鉀的致命徵兆，而非僅因疼痛或脫水',
        '先穩定高血鉀（calcium gluconate）再導尿，而非急著導尿',
        '選擇不含鉀的輸液（0.9% NaCl）而非 LRS',
        '導尿前適當鎮靜，兼顧動物福利與操作安全',
      ],
      common_pitfalls: [
        '忽略心搏過緩的意義，未立即做 ECG 和電解質',
        '在高血鉀未處理前就嘗試導尿，動物可能在導尿過程中心跳停止',
        '使用含鉀輸液（LRS）於高血鉀病患',
        '導尿時未給予適當鎮靜，造成尿道損傷或動物極度壓力',
        '出院時未強調飲食轉換與環境管理的重要性',
      ],
    },
    related_nodes_for_review: [
      'ECC-L3-004',
      'ECC-L1-002',
      'ECC-L4-001',
      'ECC-L5-001',
      'ECC-L1-003',
    ],
    tags: ['尿道阻塞', '貓', '高血鉀', '急診', '分診', 'case_challenge'],
  },
];
