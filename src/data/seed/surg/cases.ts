import type { CaseChallenge } from '@/types/case';

export const SURG_CASES: CaseChallenge[] = [
  {
    id: 'CASE-SURG-001',
    title: '大丹犬急性腹部膨脹 — 胃擴張扭轉',
    specialty: 'SURG',
    cross_specialties: ['IM', 'ECC'],
    required_nodes: ['SURG-L3-001', 'SURG-L4-001', 'SURG-L5-001'],
    difficulty: 4,
    species: '犬',
    scenario: {
      signalment: '6 歲已絕育雄性大丹犬，體重 58 kg',
      chief_complaint: '晚餐後約 2 小時突發不安、反覆作嘔但無法嘔出、腹部急速膨脹',
      brief_history: '飼主報告晚餐為一日一次大量餵食乾糧，進食後約 30 分鐘在院子裡跑跳。約 1.5 小時後開始出現焦躁不安、多次嘗試嘔吐但僅有少量泡沫、腹部明顯膨脹。無先前腹部手術史，過去健康無特殊。定期驅蟲與疫苗。',
    },
    steps: [
      {
        step_number: 1,
        step_type: 'history_collection',
        title: '病史採集與初步評估',
        prompt: '這隻大丹犬被緊急送入急診。你需要進一步確認哪些資訊？請選擇最重要的 3 項。',
        available_actions: [
          '確認嘔吐是否為非生產性（retching without vomiting）',
          '詢問腹部膨脹的發展速度（急性 vs 漸進性）',
          '詢問過去是否有類似發作或 GDV 病史',
          '詢問飼料品牌與成分',
          '詢問最近是否有疫苗接種',
          '詢問飲水量是否改變',
        ],
        correct_actions: [
          '確認嘔吐是否為非生產性（retching without vomiting）',
          '詢問腹部膨脹的發展速度（急性 vs 漸進性）',
          '詢問過去是否有類似發作或 GDV 病史',
        ],
        feedback_correct: '非生產性嘔吐（retching without vomiting）是 GDV 最典型的主訴。急性腹部膨脹在進食後 2-4 小時發生是典型的 GDV 時間框架。GDV 病史對治療決策重要——曾發生 GDV 未做 gastropexy 的犬復發率極高。',
        feedback_incorrect: 'GDV 急診中最關鍵的病史資訊是嘔吐型態（非生產性為特徵）、腹部膨脹速度（急性提示 GDV）與過去是否有類似發作。飼料品牌和疫苗史在此刻不是優先資訊。',
        key_learning_points: [
          '非生產性嘔吐（retching without vomiting）是 GDV 的最典型臨床表現',
          'GDV 通常在進食後 2-4 小時內發生',
          '大丹犬是 GDV 最高風險品種，一生發生率約 42%',
        ],
      },
      {
        step_number: 2,
        step_type: 'physical_examination',
        title: '理學檢查',
        prompt: '補充病史：嘔吐確為非生產性，腹部在 1 小時內急速膨脹，無先前類似發作。進行理學檢查，請選出最重要的 3 項發現。',
        available_actions: [
          '腹部明顯膨脹且緊繃，左側叩診呈鼓音（tympanic）',
          '心搏過速（HR 180 bpm），股動脈脈搏微弱',
          '黏膜蒼白偏灰，CRT > 3 秒',
          '體溫 38.0°C',
          '腸音減少',
          '雙側後肢反射正常',
        ],
        correct_actions: [
          '腹部明顯膨脹且緊繃，左側叩診呈鼓音（tympanic）',
          '心搏過速（HR 180 bpm），股動脈脈搏微弱',
          '黏膜蒼白偏灰，CRT > 3 秒',
        ],
        feedback_correct: '腹部鼓音提示胃內大量氣體積聚。心搏過速合併弱脈與蒼白黏膜為分配性/阻塞性休克的典型表現——擴張的胃壓迫後腔靜脈導致靜脈回流減少，心輸出量下降。這三項發現高度支持 GDV 合併心血管衰竭。',
        feedback_incorrect: '在 GDV 急診中，最關鍵的理學檢查發現是腹部膨脹（鼓音）加上休克徵候（心搏過速、弱脈、蒼白黏膜、CRT 延長）。這些代表胃擴張導致的血流動力學障礙，需要立即處置。',
        key_learning_points: [
          '腹部叩診鼓音提示胃內大量氣體，為 GDV 的重要理學檢查發現',
          '心搏過速 + 弱脈 + CRT 延長 = 血流動力學不穩定（休克）',
          'GDV 造成休克的機制：擴張胃壓迫後腔靜脈 → 靜脈回流減少 → 心輸出量下降',
        ],
      },
      {
        step_number: 3,
        step_type: 'diagnostic_plan',
        title: '急診診斷與穩定化',
        prompt: '初步高度懷疑 GDV。你的下一步行動是什麼？請選擇最適當的 3 項。',
        available_actions: [
          '立即建立兩條大口徑靜脈導管，開始 shock dose 晶體液輸液',
          '右側臥位腹部 X 光確認 GDV',
          '抽血檢驗：lactate、電解質、CBC、凝血功能',
          '立即送手術室麻醉開腹',
          '安排腹部超音波詳細評估',
          '先觀察 30 分鐘看是否自行改善',
        ],
        correct_actions: [
          '立即建立兩條大口徑靜脈導管，開始 shock dose 晶體液輸液',
          '右側臥位腹部 X 光確認 GDV',
          '抽血檢驗：lactate、電解質、CBC、凝血功能',
        ],
        feedback_correct: '積極輸液復甦是最優先的行動——在不穩定休克狀態下直接麻醉風險極高。右側臥 X 光可快速確認 GDV（「雙氣泡」或 Popeye arm sign）。Lactate 是最重要的預後指標，電解質（尤其低血鉀）影響麻醉安全性。',
        feedback_incorrect: 'GDV 急診的核心原則是「先穩定再手術」。直接送手術室或觀察等待都不恰當。需要同時進行輸液復甦、影像確診與血液檢查。腹部超音波在此情境不如 X 光快速且特異。',
        key_learning_points: [
          'GDV 急診原則：先穩定（輸液、減壓）再手術',
          '右側臥位 X 光是確診 GDV 的標準影像學方法',
          'Lactate 是 GDV 最重要的預後生物標記物',
        ],
      },
      {
        step_number: 4,
        step_type: 'result_interpretation',
        title: '檢查結果判讀',
        prompt: '檢查結果如下：\n\n- X 光：右側臥位可見典型「雙氣泡」徵象，胃極度擴張，幽門軟組織帶將胃分隔為兩個充氣腔室\n- Lactate：4.8 mmol/L\n- 電解質：K+ 3.0 mEq/L（偏低），Na+ 正常\n- CBC：PCV 55%（偏高，脫水），WBC 正常\n- 凝血：PT/aPTT 正常\n\n嘗試口胃管通過但遇到阻力無法通過。\n\n如何解讀這些結果？',
        available_actions: [
          '確認 GDV 診斷。Lactate 4.8 mmol/L 尚在可接受範圍，預後相對較佳。胃管無法通過確認有扭轉。需矯正低血鉀後進行手術。',
          '可能只是單純胃擴張（GD），因為 lactate 不高。先嘗試右側腹壁 trocar 減壓觀察。',
          'Lactate 正常，不需要緊急手術。可以先保守治療。',
          'X 光無法區分 GDV 與 GD，需要 CT 確認。',
        ],
        correct_actions: [
          '確認 GDV 診斷。Lactate 4.8 mmol/L 尚在可接受範圍，預後相對較佳。胃管無法通過確認有扭轉。需矯正低血鉀後進行手術。',
        ],
        feedback_correct: '完美！X 光「雙氣泡」+ 胃管無法通過 = 確認 GDV。Lactate 4.8 mmol/L < 6.0，胃壁壞死風險相對較低，預後較佳。低血鉀（3.0）需在麻醉前矯正，因為低鉀增加心律不整風險。PCV 偏高反映脫水（脾臟淤血也可能貢獻）。',
        feedback_incorrect: '「雙氣泡」徵象是 GDV 的特徵性 X 光表現，加上胃管無法通過，已可確診。Lactate 4.8 雖然 < 6.0（較佳預後），但 4.8 仍然異常，絕不代表「正常」或可以保守治療。GDV 必須手術處理。',
        key_learning_points: [
          '「雙氣泡」/Popeye arm sign 是 GDV 的特徵性 X 光表現',
          '胃管無法通過是 GDV 與單純 GD 的重要鑑別點',
          'Lactate < 6.0 mmol/L 預後相對較佳，但仍需手術',
          '麻醉前必須矯正低血鉀以降低心律不整風險',
        ],
      },
      {
        step_number: 5,
        step_type: 'treatment_plan',
        title: '手術計畫',
        prompt: '輸液復甦後血壓趨於穩定（MAP 65 mmHg），已補充 KCl。準備進入手術室。手術步驟應如何安排？',
        available_actions: [
          '正中開腹 → 胃 derotation → 評估胃壁與脾臟活性 → 壞死組織切除（如有）→ 右側 incisional gastropexy',
          '正中開腹 → 直接進行 gastropexy → 再進行 derotation',
          '左肋弓旁切口 → 胃切開引流 → gastropexy',
          '正中開腹 → derotation → 不做 gastropexy（術後觀察即可）',
        ],
        correct_actions: [
          '正中開腹 → 胃 derotation → 評估胃壁與脾臟活性 → 壞死組織切除（如有）→ 右側 incisional gastropexy',
        ],
        feedback_correct: '正確的手術順序：1) 正中開腹提供最佳視野；2) 先 derotation 恢復胃的正常位置（幽門推回右側）；3) 評估胃壁（特別是大彎側）與脾臟的血流與活性——灰黑色、無出血或蠕動的區域提示壞死；4) 壞死區域切除（partial gastrectomy / splenectomy）；5) 最後進行 incisional gastropexy 防止復發。',
        feedback_incorrect: '必須先 derotation 才能 gastropexy（因為胃在錯誤位置無法固定）。不做 gastropexy 的復發率高達 54-80%。正中開腹是標準入路，提供雙側腹腔完整視野。胃壁與脾臟活性評估是決定是否需要切除的關鍵步驟。',
        key_learning_points: [
          'GDV 手術標準順序：derotation → 活性評估 → 必要時切除 → gastropexy',
          '胃壁壞死評估：顏色（灰黑色 = 壞死）、漿膜面出血、切開時是否出血',
          '右側 incisional gastropexy 是預防復發的標準方式',
          '脾臟必須同時評估——脾臟扭轉或嚴重淤血需切除',
        ],
      },
      {
        step_number: 6,
        step_type: 'treatment_plan',
        title: '術中發現與處置',
        prompt: '術中發現：胃順時針扭轉約 270 度，成功 derotation。胃大彎側有一約 5x3 cm 區域呈暗紫色但切開漿膜後仍有滲血。脾臟輕度淤血但無扭轉，恢復正常位置後顏色改善。你的決定是？',
        available_actions: [
          '該暗紫區域有滲血表示尚有血流，可保留觀察。脾臟改善不需切除。完成 incisional gastropexy。',
          '暗紫區域必須立即切除（partial gastrectomy），脾臟也應預防性切除。',
          '暗紫區域保留，但脾臟應切除以預防未來腫瘤。',
          '暗紫區域注射 fluorescein 評估血流後再決定。不做 gastropexy 觀察復原。',
        ],
        correct_actions: [
          '該暗紫區域有滲血表示尚有血流，可保留觀察。脾臟改善不需切除。完成 incisional gastropexy。',
        ],
        feedback_correct: '術中胃壁活性評估的關鍵指標是漿膜面切開後是否出血。暗紫色但仍有滲血表示組織尚有血流灌注，可保留。完全灰黑色且無出血才需切除。脾臟淤血在 derotation 後改善，無需切除。Gastropexy 必須完成。',
        feedback_incorrect: '術中判斷胃壁活性的最實用方法是漿膜切開看是否出血。有滲血 = 有血流 = 可保留。不需要對有血流的組織進行 partial gastrectomy。脾臟在 derotation 後恢復正常代表淤血是可逆的。但 gastropexy 絕對不可省略。',
        key_learning_points: [
          '胃壁活性評估：漿膜切開後有滲血 = 可保留，完全無出血/灰黑色 = 壞死需切除',
          '脾臟淤血如果在 derotation 後恢復正常顏色，通常不需切除',
          '不確定的胃壁區域可術中 invagination 或術後密切監測',
          'Gastropexy 永遠是 GDV 手術的最後必要步驟',
        ],
      },
      {
        step_number: 7,
        step_type: 'case_summary',
        title: '術後管理與飼主衛教',
        prompt: '手術順利完成：derotation + incisional gastropexy，未需切除胃壁或脾臟。請選擇最適當的術後管理計畫。',
        available_actions: [
          'ICU 住院至少 48-72 小時。持續 ECG 監測（VPCs 好發 12-72 hr）。每 6-12 小時追蹤 lactate 與電解質。NPO 12-24 小時後開始少量流質。教導飼主出院後改為少量多餐。',
          '術後觀察 24 小時即可出院。每日餵食一次大量乾糧沒有問題。',
          'ICU 住院 1 週。預防性使用 Lidocaine CRI。限制飲水 48 小時。',
          '術後當天即可出院，口服止痛藥與抗生素。一週後回診拆線。',
        ],
        correct_actions: [
          'ICU 住院至少 48-72 小時。持續 ECG 監測（VPCs 好發 12-72 hr）。每 6-12 小時追蹤 lactate 與電解質。NPO 12-24 小時後開始少量流質。教導飼主出院後改為少量多餐。',
        ],
        feedback_correct: 'GDV 術後最大風險是心室心律不整（VPCs），好發於 12-72 小時，因此需 ICU 至少 48-72 小時 ECG 監測。Lactate 追蹤可確認組織灌流改善。電解質（尤其鉀離子）需密切監測。恢復餵食應從少量流質開始。長期改為少量多餐（2-3 次/日）可降低復發風險。',
        feedback_incorrect: 'GDV 是高風險外科急診，術後不可過早出院。心室心律不整在 12-72 小時內發生率 40-70%，可能致命，必須 ECG 監測。預防性 Lidocaine CRI 不是常規需要（僅在嚴重 VPCs 時使用）。飲食管理（少量多餐）是預防復發的重要生活調整。',
        key_learning_points: [
          'GDV 術後 VPCs 發生率 40-70%，好發於 12-72 小時，需 ICU ECG 監測',
          '嚴重 VPCs（R-on-T 現象或血流動力學不穩定）需 Lidocaine CRI 50-80 mcg/kg/min',
          'Lactate 在 12 小時內應逐步下降，持續升高為預後不良指標',
          '飲食管理：少量多餐（2-3 次/日）、避免進食後劇烈運動、升高食盆',
        ],
      },
    ],
    expert_pathway: {
      reasoning: '大丹犬（最高風險品種）+ 餐後急性非生產性嘔吐與腹部膨脹 = 高度懷疑 GDV。急診處理遵循「先穩定再手術」原則：積極輸液 → X 光確診 → lactate 預後評估 → derotation + gastropexy → ICU 術後監測。',
      key_decisions: [
        '即使高度懷疑 GDV 也要先穩定再手術——休克狀態下麻醉風險極高',
        '術前 lactate 判讀影響與飼主的溝通（> 6.0 需告知較高死亡率）',
        '術中胃壁活性評估決定是否需要 partial gastrectomy',
        '術後 48-72 小時持續 ECG 監測是降低 VPCs 相關死亡的關鍵',
      ],
      common_pitfalls: [
        '在未穩定血流動力學的情況下急於手術',
        '僅做胃減壓未做 gastropexy，導致高復發率',
        '忽略術後心律不整監測，VPCs 可在看似穩定的犬突然發生',
        '過早恢復正常餵食或出院',
        '未評估脾臟——脾臟撕裂出血可能在術後才表現',
      ],
    },
    related_nodes_for_review: [
      'SURG-L3-001',
      'SURG-L2-001',
      'SURG-L4-001',
      'SURG-L4-002',
      'SURG-L5-001',
      'SURG-L5-003',
    ],
    tags: ['GDV', '急診', '大丹犬', 'gastropexy', 'lactate', 'case_challenge'],
  },
];
