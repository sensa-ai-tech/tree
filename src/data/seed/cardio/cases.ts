import type { CaseChallenge } from '@/types/case';

export const CARDIO_CASES: CaseChallenge[] = [
  {
    id: 'CASE-CARDIO-001',
    title: '老年騎士查理王小獵犬的呼吸困難',
    specialty: 'CARDIO',
    cross_specialties: ['IM'],
    required_nodes: ['CARDIO-L3-001', 'CARDIO-L4-001', 'CARDIO-L5-001'],
    difficulty: 3,
    species: '犬',
    scenario: {
      signalment: '9 歲已絕育雌性騎士查理王小獵犬（CKCS），體重 7.2 kg',
      chief_complaint: '近一週夜間咳嗽頻率增加，今晨出現呼吸急促',
      brief_history: '兩年前健康檢查發現左心尖 Grade III/VI 收縮期雜音，當時心超顯示輕度 MR、LA/Ao 1.4。飼主報告最近一週 sleeping RR 由平常的 18 次/分上升至 36 次/分。食慾輕微下降，活力減退。定期驅蟲與疫苗。',
    },
    steps: [
      {
        step_number: 1,
        step_type: 'history_collection',
        title: '病史採集',
        prompt: '你需要進一步詢問哪些問題？請選擇最重要的 3 項。',
        available_actions: [
          '詢問咳嗽的時間型態（白天 vs 夜間、活動後 vs 休息時）',
          '詢問是否有暈厥或虛脫',
          '詢問目前使用的藥物',
          '詢問飲食品牌與成分',
          '詢問居家 sleeping RR 趨勢',
          '詢問是否有心絲蟲預防',
        ],
        correct_actions: [
          '詢問咳嗽的時間型態（白天 vs 夜間、活動後 vs 休息時）',
          '詢問目前使用的藥物',
          '詢問居家 sleeping RR 趨勢',
        ],
        feedback_correct: '很好！咳嗽型態有助於區分心因性 vs 呼吸道咳嗽，藥物史對治療決策至關重要，sleeping RR 趨勢是監測 CHF 最敏感的居家指標。',
        feedback_incorrect: '心因性咳嗽通常在夜間或休息時加劇。了解用藥史對於決定治療方案至關重要。Sleeping RR 是 CHF 最敏感的居家監測指標，應優先詢問。',
        key_learning_points: [
          'MMVD 咳嗽可源自左主支氣管壓迫（乾咳）或肺水腫（濕咳）',
          'Sleeping RR > 30 次/分高度提示 CHF 發生或惡化',
          '用藥史影響 Stage 分期與治療決策',
        ],
      },
      {
        step_number: 2,
        step_type: 'physical_examination',
        title: '理學檢查',
        prompt: '病史補充：咳嗽以夜間及凌晨為主，偶有白天活動後喘息。目前未服用任何心臟藥物。Sleeping RR 過去一週逐步上升（22→28→36）。請選擇最重要的理學檢查發現。',
        available_actions: [
          '左心尖 Grade IV/VI 收縮期全收縮雜音（pansystolic murmur）',
          '呼吸速率 40 次/分，可聞雙側肺底囉音（crackles）',
          '股動脈脈搏強度正常',
          '腹部觸診正常',
          '結膜粉紅、CRT 1.5 秒',
          '體溫 38.3°C（正常）',
        ],
        correct_actions: [
          '左心尖 Grade IV/VI 收縮期全收縮雜音（pansystolic murmur）',
          '呼吸速率 40 次/分，可聞雙側肺底囉音（crackles）',
        ],
        feedback_correct: '正確！心雜音等級由 III 級升至 IV 級提示 MR 惡化。雙側肺底囉音加上呼吸速率增加（40 次/分）高度提示肺水腫，支持 CHF 的診斷。',
        feedback_incorrect: '在心臟病患的理學檢查中，心臟聽診和呼吸系統評估是最關鍵的發現。心雜音等級變化反映 MR 嚴重度，肺部囉音直接反映肺水腫程度。',
        key_learning_points: [
          '心雜音等級變化需與之前紀錄比較，追蹤 MR 進展',
          '肺底部雙側囉音（crackles）是肺水腫的典型聽診發現',
          '呼吸速率 > 30-40 次/分在靜息狀態下提示呼吸窘迫',
        ],
      },
      {
        step_number: 3,
        step_type: 'differential_diagnosis',
        title: '鑑別診斷',
        prompt: '基於目前資訊，請列出最可能的鑑別診斷清單（選擇 3 個最相關的）。',
        available_actions: [
          'MMVD Stage C（充血性心衰竭）',
          '犬慢性支氣管炎',
          '腱索斷裂導致急性 MR 加劇',
          '肺腫瘤',
          '感染性肺炎',
          '心包膜積液',
        ],
        correct_actions: [
          'MMVD Stage C（充血性心衰竭）',
          '腱索斷裂導致急性 MR 加劇',
          '犬慢性支氣管炎',
        ],
        feedback_correct: '優秀！MMVD Stage C 是最可能的診斷。腱索斷裂可導致急性 MR 惡化，需心超排除。慢性支氣管炎在老年小型犬常見，且可與 MMVD 共存。',
        feedback_incorrect: '老年 CKCS 有已知 MMVD 病史 + 漸進性呼吸困難 + sleeping RR 上升 → MMVD Stage C 是最可能的診斷。腱索斷裂可導致急性惡化，需列入考量。',
        key_learning_points: [
          'CKCS 幾乎 100% 在 10 歲前會發生 MMVD',
          'Sleeping RR 逐步上升是 CHF 進展最早期的居家指標',
          '慢性支氣管炎是 MMVD 犬最常見的共病',
        ],
      },
      {
        step_number: 4,
        step_type: 'diagnostic_plan',
        title: '診斷計畫',
        prompt: '你會安排哪些檢查？選擇最適當的 3 項。',
        available_actions: [
          '胸腔 X 光（右側臥位 + DV）',
          '心臟超音波（完整評估）',
          '基礎血檢（CBC/BCS 含腎功能指數）',
          '心電圖',
          '腹部超音波',
          'CT 掃描',
        ],
        correct_actions: [
          '胸腔 X 光（右側臥位 + DV）',
          '心臟超音波（完整評估）',
          '基礎血檢（CBC/BCS 含腎功能指數）',
        ],
        feedback_correct: '完美！胸腔 X 光評估心臟大小（VHS）和肺野浸潤。心超確認 MMVD 分期（LA/Ao、LVIDDN）。血檢評估腎功能，因為 ACE 抑制劑和利尿劑會影響腎功能。',
        feedback_incorrect: '胸腔 X 光是評估心臟大小（VHS）和肺水腫的第一線工具。心超是 MMVD 確診和分期的金標準。利尿劑與 ACE 抑制劑治療前必須評估腎功能基線。',
        key_learning_points: [
          '胸腔 X 光：VHS 評估心臟大小，肺野評估肺水腫',
          '心超：LA/Ao 和 LVIDDN 是 ACVIM 分期的關鍵指標',
          '腎功能基線在開始利尿劑 + ACE 抑制劑前必須建立',
        ],
      },
      {
        step_number: 5,
        step_type: 'result_interpretation',
        title: '檢查結果判讀',
        prompt: '檢查結果如下：\n• X 光：VHS 12.0，肺門至尾葉有間質到肺泡浸潤型態\n• 心超：LA/Ao 2.1，LVIDDN 2.0（增加），FS 42%（正常），重度 MR\n• 血檢：BUN 28 mg/dL，Cre 1.4 mg/dL（均正常上限）\n\n這些結果指向什麼結論？',
        available_actions: [
          'MMVD Stage C：明確心臟擴大（VHS 12.0、LA/Ao 2.1）+ 肺水腫 + 臨床症狀',
          'MMVD Stage B2：有心臟重塑但肺部浸潤為其他原因',
          'MMVD Stage D：對治療反應不佳',
          'DCM 合併 CHF',
        ],
        correct_actions: [
          'MMVD Stage C：明確心臟擴大（VHS 12.0、LA/Ao 2.1）+ 肺水腫 + 臨床症狀',
        ],
        feedback_correct: '正確！VHS 12.0（遠超 10.5 正常上限）+ LA/Ao 2.1（> 1.6）確認心臟重塑。肺野浸潤型態符合心因性肺水腫。FS 42% 仍正常代表心肌收縮力尚維持。合併臨床症狀（咳嗽、呼吸急促）→ Stage C。',
        feedback_incorrect: '仔細看數據：VHS 12.0 >>> 10.5（嚴重心臟擴大）。LA/Ao 2.1 >>> 1.6（嚴重左心房擴大）。肺野浸潤 = 肺水腫。加上臨床症狀（咳嗽、呼吸困難），這就是 Stage C 的定義。Stage D 需要對治療有反應不佳才能診斷。',
        key_learning_points: [
          'VHS > 10.5 提示心臟擴大，12.0 為嚴重擴大',
          'LA/Ao > 1.6 符合 Stage B2 以上的標準，2.1 為嚴重左心房擴大',
          'FS 正常 + MR = 瓣膜性而非心肌性（排除 DCM）',
          'Stage C = 有心臟重塑 + 有 CHF 臨床症狀（首次或復發）',
        ],
      },
      {
        step_number: 6,
        step_type: 'treatment_plan',
        title: '治療計畫',
        prompt: '你的治療方案是什麼？選擇最適當的組合。',
        available_actions: [
          '三合一療法：Pimobendan 0.25 mg/kg PO BID + Furosemide 2 mg/kg PO BID + Enalapril 0.5 mg/kg PO BID',
          '僅 Pimobendan 0.25 mg/kg PO BID',
          '三合一療法 + Spironolactone 1 mg/kg PO SID',
          'Atenolol 0.5 mg/kg PO BID + Furosemide',
        ],
        correct_actions: [
          '三合一療法：Pimobendan 0.25 mg/kg PO BID + Furosemide 2 mg/kg PO BID + Enalapril 0.5 mg/kg PO BID',
        ],
        feedback_correct: '完美！Stage C 的標準治療是三合一：Pimobendan（正性肌力 + 血管擴張）+ Furosemide（減少體液滯留）+ ACE inhibitor（抑制 RAAS）。初次 Stage C 先使用標準三合一，效果不佳再考慮加上 Spironolactone。',
        feedback_incorrect: '初次 Stage C 的標準治療為三合一療法。單用 Pimobendan 不足以控制 CHF。Spironolactone 通常是三合一療法反應不佳時的第四線加入。Beta blocker 在 MMVD 合併 CHF 中不是第一線選擇。',
        key_learning_points: [
          'Stage C 三合一：Pimobendan + Furosemide + ACE inhibitor',
          'Pimobendan：PDE III 抑制 + 鈣敏化，增強收縮力不增加耗氧',
          'Furosemide：環利尿劑，減少體液滯留與肺水腫',
          'ACE inhibitor：抑制 RAAS，減少後負荷與鈉水滯留',
        ],
      },
      {
        step_number: 7,
        step_type: 'case_summary',
        title: '病例總結與追蹤',
        prompt: '請選擇最適當的追蹤計畫。',
        available_actions: [
          '出院後 7-14 天回診，追蹤腎功能（BUN/Cre）、胸腔 X 光、sleeping RR，之後每 1-3 個月回診',
          '出院後 1 個月回診即可',
          '出院後 3 個月回診，追蹤心超',
          '不需特別追蹤，除非症狀復發',
        ],
        correct_actions: [
          '出院後 7-14 天回診，追蹤腎功能（BUN/Cre）、胸腔 X 光、sleeping RR，之後每 1-3 個月回診',
        ],
        feedback_correct: '正確！開始利尿劑與 ACE 抑制劑後，7-14 天內必須追蹤腎功能（可能惡化）。胸腔 X 光確認肺水腫改善。教導飼主持續記錄 sleeping RR。穩定後每 1-3 個月回診追蹤。',
        feedback_incorrect: '開始 Furosemide + ACE inhibitor 後，腎前性氮血症的風險增加。必須在 7-14 天內追蹤 BUN/Cre。等太久回診可能錯過腎功能惡化或藥物劑量需要調整的時機。',
        key_learning_points: [
          '利尿劑 + ACE inhibitor 可能導致腎功能惡化，需早期監測',
          'Sleeping RR 是居家監測 CHF 控制情況最實用的指標',
          'MMVD Stage C 需要終身藥物治療和定期追蹤',
          '飼主衛教（用藥依從性、居家監測）是 CHF 管理成功的關鍵',
        ],
      },
    ],
    expert_pathway: {
      reasoning: '老年 CKCS + 已知 MMVD 病史 + 漸進性呼吸困難 + sleeping RR 上升 = MMVD 進展至 Stage C。系統性評估確認診斷後，啟動標準三合一治療並安排密切追蹤。',
      key_decisions: [
        '優先評估呼吸窘迫程度，必要時先給氧支持再進行檢查',
        '利用 sleeping RR 趨勢判斷 CHF 進展時間軸',
        '根據 ACVIM 分期決定治療方案',
        '治療後 7-14 天追蹤腎功能',
      ],
      common_pitfalls: [
        '在呼吸窘迫時強行拍 X 光造成動物額外壓力',
        '忽略腎功能基線評估就開始利尿劑治療',
        '未教導飼主 sleeping RR 監測方法',
        '將所有咳嗽都歸因於心臟病，忽略呼吸道共病',
      ],
    },
    related_nodes_for_review: [
      'CARDIO-L3-001',
      'CARDIO-L4-001',
      'CARDIO-L4-002',
      'CARDIO-L5-001',
    ],
    tags: ['MMVD', 'CHF', 'CKCS', 'staging', 'treatment', 'case_challenge'],
  },
];
